# Google Calendar

[telegram](https://t.me/slava_shagalov) - для связи.

## 1. Тема и целевая аудитория

**Google Calendar** — сервис для планирования встреч, событий и дел, организации рабочего времени.

### MVP

- Регистрация, авторизация.
- Создание, редактирование календарей.
- Каждый календарь можно сделать общедоступным либо предоставить отдельным пользователям права на просмотр и
  редактирование.
- Уведомления и приглашения в календарь по электронной почте.
- Создание, редактирование напоминаний (событий), которые включают в себя время, периодичность, время уведомления.

### Целевая аудитория

MAU = 500
млн. [[1]](https://www.patronum.io/key-google-workspace-statistics-for-2023/#:~:text=Google%20Calendar%20has%20over%20500%20million%20active%20users%20per%20month.)

Из-за отсутствия информации о DAU, примем его равным 20 млн. пользователей.

#### Географическое распространение [[2]](https://hypestat.com/info/calendar.google.com#:~:text=Visitors%20by%20country,2.8%25)

| Страна   | Процент пользователей от общего числа, % | Количество, млн |
|----------|:----------------------------------------:|:---------------:|
| США      |                  18.8%                   |       94        |
| Индия    |                  10.7%                   |      53.5       |
| Япония   |                   5.2%                   |       26        |
| Россия   |                   2.9%                   |      14.5       |
| Бразилия |                   2.8%                   |       14        | 

## 2. Расчет нагрузки

[1 мб 2 млрд. зарегистрированных, так как 3 млрд в google workspace и 500 мау.](https://developers.googleblog.com/2022/01/year-in-review-google-workspace.html#:~:text=Google%20Workspace%20grew%20to%20more%20than%203%20billion%20users%20globally)

Новых событий в день - 1.5
млрд. [[3]](https://abdalslam.com/google-workspace-statistics#:~:text=Google%20Calendar,Over%201.5%20billion)

### Продуктовые метрики

#### Хранилище пользователя

- Профиль:
    - email - 254
      B [[4]](https://www.rfc-editor.org/errata_search.php?rfc=3696&eid=1690#:~:text=the%20upper%0A%20%20%20limit%20on%20address%20lengths%20should%20normally%20be%20considered%20to%20be%20254.)
    - Пароль - 100 B
    - first name + last name - 100
      B [[5]](https://www.geekslop.com/technology-articles/2016/here-are-the-recommended-maximum-data-length-limits-for-common-database-and-programming-fields#:~:text=35%20chars%20(US)%2C-,50%20(other),-Last%20name)
    - Часовой пояс - 4 B, ссылка на часовой пояс
    - **Общий размер:** 254 + 100 + 100 + 4 = 458 B

[//]: # (  - Часовой пояс - 32 B [[6]]&#40;https://learn.microsoft.com/en-us/dotnet/api/system.timezoneinfo.id?view=net-7.0&redirectedfrom=MSDN#System_TimeZoneInfo_Id:~:text=we%20recommend%20that%20an%20identifier%20that%20you%20assign%20to%20a%20custom%20time%20zone%20be%2032%20characters%20or%20fewer.&#41;)

- Календари:
    - В среднем у пользователя около 2-х календарей.
    - Название - 100 B
    - Описание - 500 B.
    - Часовой пояс - 4 B, ссылка на часовой пояс
    - Владелец - 4 B, ссылка на пользователя
    - Время создания - 8 B
    - Время обновления - 8 B
    - Размер одного календаря: 100 + 500 + 4 + 4 + 8 + 8 = 624 байт.
    - **Общий размер:** 2 * 624 байт = 1248 байт = 1.22 Kбайт.

- Подписки на календарь:
    - В среднем у пользователя около 3-х подписок на чужие календари.
    - Календарь - 4 B, ссылка на календарь
    - Участник - 4 B, ссылка на пользователя
    - **Общий размер:** 3 * (4 + 4) = 24 B

- События:
    - В среднем у пользователя около 300 событий.
    - Название - 100 B.
    - Описание - 500 B.
    - Владелец - 4 B, ссылка на пользователя
    - Календарь - 4 B, ссылка на календарь
    - Время начала - 8 B
    - Время окончания - 8 B
    - Время создания - 8 B
    - Время обновления - 8 B
    - Размер одного события: 100 + 500 + 4 + 4 + 8 + 8 + 8 + 8 = 640 байт.
    - **Общий размер:** 300 * 640 = 192000 байт = 187.5 Кбайт

- Подписки на события:
    - В среднем у пользователя около 500 подписок на чужие события.
    - Событие - 4 B, ссылка на событие
    - Участник - 4 B, ссылка на пользователя
    - **Общий размер:** 500 * (4 + 4) = 4000 B = 3.91 KB

#### Среднее количество действий пользователя по типам в день

Исходя из статистики, в среднем, пользователь проверяет календарь 4 раза / день. Пользователь в среднем создает
1 событие в неделю (4 в месяц).

| **Тип действия**       | **Частота** |
|------------------------|-------------|
| просмотр календаря     | 4 / день    |
| открытие события       | 1  / день   |
| создание события       | 1 / неделя  |
| редактирование события | 1 / неделя  |

### Технические метрики

#### Размер хранения в разбивке по типам данных

- Профиль: 458 B * 1 млрд = 426.5 GB
- Календари: 1.22 KB * 1 млрд = 1.1 TB
- События: 187.5 KB * 1 млрд = 174.6 TB

#### Сетевой трафик

- Пиковое потребление в течение суток (в Гбит/с).

Обычно, пиковое потребление трафика для онлайн календарей приходится на утренние и вечерние часы, когда
пользователи планируют свой день или проверяют свои расписания на следующий день.

Пусть в календаре каждый день в среднем 3 события. События прогружаются на месяц.
Значит, в среднем просмотр календаря включает получение 3 * 30 = 90 событий.

Так как пользователь в среднем подписан на 3 чужих календаря и в среднем имеет 2 своих, то
общий размер пикового трафика 20 млн * (458 B + 1.22 KB + 90 * 187.5 KB)

- Суммарный суточный (Гбайт/сутки)

- RPS

Так как количество уникальных пользователей в день составляет 20 млн, то в качестве дневной аудитории возьмём 60 млн,
так как часть пользователей посещает сервис ~3 раза в течение дня.

1. Просмотр календаря.

   Каждый пользователь из числа DAU смотрит календарь в среднем 3 раза в день.

   Один просмотр включает запрос на получение календаря вместе событиями и запрос на получение данных пользователя.

   **Средний RPS:** 20 млн * 3 * (1 + 1) / 86400 сек = 1389 RPS.

   Пусть в календаре каждый день в среднем 3 события. События прогружаются на месяц.
   Значит, в среднем запрос календаря включает получение 3 * 30 = 90 событий.

   **Средний трафик:** (624 + 90 * 640) байт * 8 * 1389 = 646985088 бит/с = 646.98 Мбит/с.

   **Сумарный суточный трафик:** 646985088 бит/с / 8 * 86400 = 6.35 Пбайт/сутки.

2. Создание события.

   Согласно статистике, пользователь создает 1 событие в неделю.

   Для создания события происходит один запрос.

   **Средний RPS:** 20 млн * (1 / 7) * 1 / 86400 сек = 33 RPS.

   **Средний трафик:** 640 байт * 8 * 33 = 168960 бит/с = 168.96 Кбит/с.

   **Сумарный суточный трафик:** 168960 бит/с / 8 * 86400 = 1.7 Гбайт/сутки.

3. Получение уведомлений/напоминаний.

   95% всех событий - без дополнительных участников. Пусть события с участниками имеют в среднем 5 участников. Итого,
   если в день 7920000 событий, то 7524000 уведомлений и напоминаний только для организатора + 396000 уведомлений и
   напоминаний для 5 участников.

   **Средний RPS:** Итого (7524000 * 3 + 396000 * 5 * 2 + 396000 * 5) / (24 * 3600) = 330 RPS в сервис напоминаний.

   **Средний трафик:** 640 байт * 8 * 463 = 2370560 бит/с = 2.37 Мбит/с.

Для получения пиковых значений трафика и RPS умножим среднее потребление в два раза.

| Действие                          | RPS  | Пиковый RPS | Средний трафик | Пиковый трафик | Суммарный суточный трафик |
|-----------------------------------|------|-------------|:--------------:|:--------------:|:-------------------------:|
| Регистрация                       |      |             |       0        |       0        |         0 Гб/сут          |
| Авторизация                       |      |             |       0        |       0        |         0 Гб/сут          |
| Изменение профиля                 |      |             |       0        |       0        |         0 Гб/сут          |
| Просмотр календаря                | 1389 | 2800        | 646.98 Мбит/с  |   1.3 Гбит/с   |     6.35 Пбайт/сутки      |
| Создание события                  | 33   | 66          | 168.96 Кбит/с  |   320 Кбит/с   |      1.7 Гбайт/сутки      |
| Получение уведомлений/напоминаний |      |             |       0        |       0        |         0 Мб/сут          |

## 3. Источники

1. https://www.patronum.io/key-google-workspace-statistics-for-2023/
2. https://hypestat.com/info/calendar.google.com
3. https://abdalslam.com/google-workspace-statistics
4. https://www.rfc-editor.org/errata_search.php?rfc=3696&eid=1690
5. https://www.geekslop.com/technology-articles/2016/here-are-the-recommended-maximum-data-length-limits-for-common-database-and-programming-fields
6. https://learn.microsoft.com/en-us/dotnet/api/system.timezoneinfo.id?view=net-7.0&redirectedfrom=MSDN

